# NRD Data Access - Guía de Uso

Esta es una librería de acceso a datos para Firebase Realtime Database. Sigue estas instrucciones para usarla correctamente en tus proyectos.

## Instalación

Incluye la librería en tu HTML usando una de estas opciones:

```html
<!-- Opción 1: GitHub Pages -->
<script src="https://yosbany.github.io/nrd-data-access/dist/nrd-data-access.js"></script>

<!-- Opción 2: jsDelivr CDN -->
<script src="https://cdn.jsdelivr.net/gh/yosbany/nrd-data-access@main/dist/nrd-data-access.js"></script>
```

## Inicialización

```javascript
const nrd = new NRDDataAccess();
```

## Autenticación

```javascript
// Iniciar sesión
await nrd.auth.signIn('usuario@email.com', 'contraseña');

// Registrar usuario
await nrd.auth.signUp('nuevo@email.com', 'contraseña');

// Cerrar sesión
await nrd.auth.signOut();

// Obtener usuario actual
const user = nrd.auth.getCurrentUser();

// Escuchar cambios de autenticación
const unsubscribe = nrd.auth.onAuthStateChanged((user) => {
  if (user) {
    console.log('Usuario autenticado:', user.email);
  } else {
    console.log('No autenticado');
  }
});
```

## Operaciones CRUD (para todas las entidades: accounts, areas, categories, clients, employees, orders, processes, products, roles, tasks, transactions)

```javascript
// Obtener todos
const items = await nrd.clients.getAll();

// Obtener por ID
const item = await nrd.clients.getById('id');

// Crear
const id = await nrd.clients.create({ name: 'Juan', phone: '123' });

// Actualizar
await nrd.clients.update('id', { phone: '456' });

// Eliminar
await nrd.clients.delete('id');

// Consultar por campo
const results = await nrd.clients.queryByChild('name', 'Juan');

// Escuchar cambios en tiempo real (todos)
const unsubscribe = nrd.clients.onValue((items) => {
  console.log('Actualizado:', items);
});

// Escuchar cambios de uno específico
const unsubscribe = nrd.clients.onValueById('id', (item) => {
  console.log('Actualizado:', item);
});
```

## CompanyInfo (Objeto único, métodos especiales)

```javascript
// Obtener
const info = await nrd.companyInfo.get();

// Establecer/reemplazar completo
await nrd.companyInfo.set({
  tradeName: 'Mi Empresa',
  address: 'Calle 123',
  phone: '123456'
});

// Actualizar parcial
await nrd.companyInfo.update({ phone: '789' });
```

## Modelos de Datos

### Account
```typescript
{ name: string; active?: boolean; initialBalance?: number; }
```

### Area
```typescript
{ name: string; description?: string; managerEmployeeId?: string; }
```

### Category
```typescript
{ name: string; type: 'income' | 'expense'; active?: boolean; }
```

### Client
```typescript
{ name: string; address?: string; phone?: string; description?: string; }
```

### CompanyInfo
```typescript
{ address?: string; email?: string; legalName?: string; mission?: string; mobile?: string; phone?: string; rut?: string; tradeName?: string; vision?: string; }
```

### Employee
```typescript
{ name: string; roleIds?: string[]; }
```

### Order
```typescript
{ clientId: string; clientName?: string; status: string; total: number; createdAt?: number; deliveryDate?: number; items?: OrderItem[]; }
OrderItem: { productId: string; productName?: string; quantity: number; price: number; }
```

### Process
```typescript
{ name: string; areaId?: string; objective?: string; taskIds?: string[]; activities?: ProcessActivity[]; }
ProcessActivity: { name: string; taskId: string; }
```

### Product
```typescript
{ name: string; price: number; active?: boolean; }
```

### Role
```typescript
{ name: string; }
```

### Task
```typescript
{ name: string; description?: string; processId?: string; order?: number; type?: string; assignedEmployeeId?: string; roleIds?: string[]; estimatedTime?: number; executionSteps?: string[]; successCriteria?: string[]; commonErrors?: string[]; }
```

### Transaction
```typescript
{ type: 'income' | 'expense'; accountId: string; accountName?: string; amount: number; categoryId?: string; categoryName?: string; description?: string; date: number; createdAt?: number; }
```

## Servicios Disponibles

- `nrd.auth` - AuthService
- `nrd.accounts` - AccountsService
- `nrd.areas` - AreasService
- `nrd.categories` - CategoriesService
- `nrd.clients` - ClientsService
- `nrd.companyInfo` - CompanyInfoService (métodos: get, set, update)
- `nrd.employees` - EmployeesService
- `nrd.orders` - OrdersService
- `nrd.processes` - ProcessesService
- `nrd.products` - ProductsService
- `nrd.roles` - RolesService
- `nrd.tasks` - TasksService
- `nrd.transactions` - TransactionsService

## Notas Importantes

1. Todos los métodos son asíncronos - usa `await` o `.then()`
2. Siempre maneja errores con `try/catch`
3. Los IDs se generan automáticamente al crear registros
4. `onValue()` y `onValueById()` retornan función para desuscribirse
5. CompanyInfo es un objeto único, no una colección
6. Todos los campos marcados con `?` son opcionales

## Agregar Nuevos Métodos

Si necesitas un método específico que no está disponible en la librería, simplemente solicita las instrucciones para implementarlo en este proyecto. El método se agregará al servicio correspondiente siguiendo los patrones establecidos en `BaseService`.

**Ejemplo de solicitud:**
- "Necesito un método para ordenar productos por precio"
- "Quiero un método para buscar clientes por rango de fechas"
- "Necesito filtrar transacciones por múltiples criterios"

## Repositorio

https://github.com/yosbany/nrd-data-access

